# æ•°æ®åº“é›†æˆå®Œæˆæ€»ç»“

## ğŸ¯ é›†æˆæ¦‚è¿°

å·²æˆåŠŸå°† CMS ç®¡ç†åå°ç³»ç»Ÿä»æ¨¡æ‹Ÿæ•°æ®æ”¹ä¸ºä½¿ç”¨çœŸå®çš„ Supabase æ•°æ®åº“æŸ¥è¯¢ã€‚ç³»ç»Ÿç°åœ¨å®Œå…¨åŸºäºæ‚¨çš„ `admin_users` è¡¨è¿›è¡Œæ•°æ®æ“ä½œã€‚

## âœ… å®Œæˆçš„ä¿®æ”¹

### 1. åç«¯æœåŠ¡å™¨æ”¹é€ 

#### æ•°æ®åº“è¿æ¥
- âœ… é›†æˆ Supabase å®¢æˆ·ç«¯
- âœ… æ·»åŠ ç¯å¢ƒå˜é‡é…ç½®æ£€æŸ¥
- âœ… å®ç°æ•°æ®åº“è¿æ¥æµ‹è¯•æ¥å£

#### è®¤è¯ç³»ç»Ÿ
- âœ… ç™»å½•éªŒè¯æ”¹ä¸ºæ•°æ®åº“æŸ¥è¯¢
- âœ… ç”¨æˆ·ä¿¡æ¯è·å–æ”¹ä¸ºæ•°æ®åº“æŸ¥è¯¢
- âœ… ç™»å½•æ—¶é—´è‡ªåŠ¨æ›´æ–°

#### ä»ªè¡¨æ¿æ•°æ®
- âœ… ç»Ÿè®¡æ•°æ®æ”¹ä¸ºçœŸå®æ•°æ®åº“æŸ¥è¯¢
- âœ… ç”¨æˆ·åˆ—è¡¨æ”¹ä¸ºæ•°æ®åº“æŸ¥è¯¢
- âœ… æ”¯æŒæ•°æ®åˆ·æ–°åŠŸèƒ½

### 2. æ•°æ®æŸ¥è¯¢åŠŸèƒ½

#### ç»Ÿè®¡æ•°æ®æŸ¥è¯¢
```javascript
// æ€»ç”¨æˆ·æ•°
const { count: totalUsers } = await supabase
  .from('admin_users')
  .select('*', { count: 'exact', head: true });

// æ´»è·ƒç”¨æˆ·æ•°ï¼ˆæœ€è¿‘7å¤©ç™»å½•ï¼‰
const { count: activeUsers } = await supabase
  .from('admin_users')
  .select('*', { count: 'exact', head: true })
  .gte('last_login', sevenDaysAgo.toISOString())
  .eq('is_active', true);

// æ–°å¢ç”¨æˆ·æ•°ï¼ˆæœ€è¿‘30å¤©æ³¨å†Œï¼‰
const { count: newUsers } = await supabase
  .from('admin_users')
  .select('*', { count: 'exact', head: true })
  .gte('created_at', thirtyDaysAgo.toISOString());
```

#### ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢
```javascript
const { data: users } = await supabase
  .from('admin_users')
  .select('id, email, last_login, is_active, created_at')
  .order('last_login', { ascending: false })
  .limit(10);
```

### 3. æ–°å¢ API æ¥å£

- `GET /api/test-db` - æ•°æ®åº“è¿æ¥æµ‹è¯•
- `GET /api/auth/profile` - è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯
- `GET /api/dashboard` - è·å–çœŸå®ä»ªè¡¨æ¿æ•°æ®
- `GET /api/dashboard/refresh` - åˆ·æ–°ä»ªè¡¨æ¿æ•°æ®

## ğŸ”§ é…ç½®è¦æ±‚

### ç¯å¢ƒå˜é‡é…ç½®
åœ¨ `server/.env` æ–‡ä»¶ä¸­é…ç½®ï¼š

```env
PORT=3001
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
NODE_ENV=development

# Supabase é…ç½®
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_ANON_KEY=your-anon-key-here
```

### æ•°æ®åº“è¡¨ç»“æ„
ä½¿ç”¨ç°æœ‰çš„ `admin_users` è¡¨ï¼š

```sql
CREATE TABLE IF NOT EXISTS admin_users (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  password VARCHAR(255) NOT NULL,
  role VARCHAR(20) DEFAULT 'admin' CHECK (role IN ('admin', 'super_admin')),
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  last_login TIMESTAMP WITH TIME ZONE
);
```

## ğŸ”‘ ç™»å½•ä¿¡æ¯

æ ¹æ®æ‚¨çš„æ•°æ®åº“é…ç½®ï¼š
- **é‚®ç®±**: `yangda611@gmail.com`
- **å¯†ç **: `chenyang123`

## ğŸ“Š æ•°æ®å±•ç¤º

### ç»Ÿè®¡æ•°æ®
- **æ€»ç”¨æˆ·æ•°**: ä» `admin_users` è¡¨æŸ¥è¯¢æ€»è®°å½•æ•°
- **æ´»è·ƒç”¨æˆ·æ•°**: æŸ¥è¯¢æœ€è¿‘7å¤©æœ‰ç™»å½•è®°å½•çš„ç”¨æˆ·
- **æ–°å¢ç”¨æˆ·æ•°**: æŸ¥è¯¢æœ€è¿‘30å¤©æ³¨å†Œçš„ç”¨æˆ·
- **å¢é•¿ç‡**: åŸºäºæ–°å¢ç”¨æˆ·æ•°è®¡ç®—

### ç”¨æˆ·åˆ—è¡¨
- æ˜¾ç¤ºæœ€è¿‘ç™»å½•çš„10ä¸ªç”¨æˆ·
- åŒ…å«é‚®ç®±ã€æœ€åç™»å½•æ—¶é—´ã€æ´»è·ƒçŠ¶æ€
- æŒ‰æœ€åç™»å½•æ—¶é—´å€’åºæ’åˆ—

## ğŸš€ å¯åŠ¨æ­¥éª¤

### 1. é…ç½®æ•°æ®åº“
```bash
cd server
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ Supabase é…ç½®
```

### 2. å®‰è£…ä¾èµ–
```bash
cd server
npm install
```

### 3. æµ‹è¯•é…ç½®
```bash
./check-db-config.sh
```

### 4. å¯åŠ¨ç³»ç»Ÿ
```bash
./start.sh
```

## ğŸ” æµ‹è¯•æ¥å£

### æ•°æ®åº“è¿æ¥æµ‹è¯•
```bash
curl http://localhost:3001/api/test-db
```

### ç™»å½•æµ‹è¯•
```bash
curl -X POST http://localhost:3001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"yangda611@gmail.com","password":"chenyang123"}'
```

### ä»ªè¡¨æ¿æ•°æ®æµ‹è¯•
```bash
# å…ˆè·å– tokenï¼Œç„¶åæµ‹è¯•ä»ªè¡¨æ¿æ•°æ®
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:3001/api/dashboard
```

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

1. **JWT è®¤è¯**: æ‰€æœ‰ API æ¥å£éƒ½éœ€è¦æœ‰æ•ˆçš„ JWT token
2. **ç”¨æˆ·çŠ¶æ€æ£€æŸ¥**: åªå…è®¸ `is_active=true` çš„ç”¨æˆ·ç™»å½•
3. **å¯†ç éªŒè¯**: åŸºäºæ•°æ®åº“ä¸­çš„å¯†ç è¿›è¡ŒéªŒè¯
4. **ç™»å½•æ—¶é—´æ›´æ–°**: æ¯æ¬¡ç™»å½•è‡ªåŠ¨æ›´æ–° `last_login` å­—æ®µ

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

1. **æŸ¥è¯¢ä¼˜åŒ–**: ä½¿ç”¨ `count` æŸ¥è¯¢è·å–ç»Ÿè®¡æ•°æ®
2. **ç´¢å¼•æ”¯æŒ**: åˆ©ç”¨æ•°æ®åº“ç´¢å¼•æé«˜æŸ¥è¯¢æ€§èƒ½
3. **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
4. **è¿æ¥æ± **: Supabase å®¢æˆ·ç«¯è‡ªåŠ¨ç®¡ç†è¿æ¥æ± 

## ğŸ”„ æ•°æ®åŒæ­¥

- **å®æ—¶æŸ¥è¯¢**: æ¯æ¬¡è®¿é—®éƒ½æŸ¥è¯¢æœ€æ–°æ•°æ®
- **è‡ªåŠ¨åˆ·æ–°**: æ”¯æŒæ‰‹åŠ¨åˆ·æ–°æ•°æ®
- **çŠ¶æ€æ›´æ–°**: ç™»å½•æ—¶è‡ªåŠ¨æ›´æ–°ç”¨æˆ·çŠ¶æ€

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ Supabase URL å’Œ Key æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
   - æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

2. **ç™»å½•å¤±è´¥**
   - ç¡®è®¤ç”¨æˆ·é‚®ç®±å’Œå¯†ç æ­£ç¡®
   - æ£€æŸ¥ç”¨æˆ· `is_active` çŠ¶æ€
   - æŸ¥çœ‹æ•°æ®åº“ä¸­çš„ç”¨æˆ·è®°å½•

3. **æ•°æ®æŸ¥è¯¢å¤±è´¥**
   - æ£€æŸ¥ `admin_users` è¡¨æ˜¯å¦å­˜åœ¨
   - ç¡®è®¤è¡¨ç»“æ„æ˜¯å¦æ­£ç¡®
   - æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å¯†ç å®‰å…¨**: å½“å‰ä½¿ç”¨æ˜æ–‡å¯†ç æ¯”è¾ƒï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨å“ˆå¸Œ
2. **æƒé™æ§åˆ¶**: åŸºäº `is_active` å­—æ®µæ§åˆ¶ç”¨æˆ·è®¿é—®
3. **æ•°æ®å¤‡ä»½**: å»ºè®®å®šæœŸå¤‡ä»½ Supabase æ•°æ®
4. **ç›‘æ§æ—¥å¿—**: å…³æ³¨æœåŠ¡å™¨æ—¥å¿—ï¼ŒåŠæ—¶å‘ç°é—®é¢˜

## ğŸ‰ æ€»ç»“

ç³»ç»Ÿå·²æˆåŠŸä»æ¨¡æ‹Ÿæ•°æ®è¿ç§»åˆ°çœŸå®æ•°æ®åº“æŸ¥è¯¢ï¼š

- âœ… **å®Œå…¨é›†æˆ**: æ‰€æœ‰æ•°æ®éƒ½æ¥è‡ª Supabase æ•°æ®åº“
- âœ… **å®æ—¶æŸ¥è¯¢**: æ¯æ¬¡è®¿é—®éƒ½è·å–æœ€æ–°æ•°æ®
- âœ… **å®‰å…¨è®¤è¯**: åŸºäºæ•°æ®åº“çš„ç”¨æˆ·è®¤è¯
- âœ… **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… **é…ç½®æ£€æŸ¥**: è‡ªåŠ¨æ£€æŸ¥æ•°æ®åº“é…ç½®
- âœ… **æµ‹è¯•å·¥å…·**: æä¾›æ•°æ®åº“è¿æ¥æµ‹è¯•

ç°åœ¨ç³»ç»Ÿå®Œå…¨åŸºäºæ‚¨çš„çœŸå®æ•°æ®åº“è¿è¡Œï¼Œæ‰€æœ‰ç”¨æˆ·æ•°æ®å’Œç»Ÿè®¡æ•°æ®éƒ½æ¥è‡ª `admin_users` è¡¨çš„çœŸå®æŸ¥è¯¢ç»“æœã€‚